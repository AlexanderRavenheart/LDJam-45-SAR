[gd_scene load_steps=6 format=2]

[ext_resource path="res://Assets/Objects/asteroid1.png" type="Texture" id=1]
[ext_resource path="res://Systems/Offense/TakesDamage.tscn" type="PackedScene" id=2]
[ext_resource path="res://Systems/LevelWarp.tscn" type="PackedScene" id=3]

[sub_resource type="GDScript" id=1]
script/source = "extends RigidBody2D

var max_starting_speed := 200
var move_direction := Vector2()
var force := Vector2()

var asteroid_resource = load(\"res://Objects/Asteroid.tscn\")

var current_hp := 100
var current_size := 3

func _ready():
	move_direction = Vector2((randi() % 2) - 1, (randi() % 2) - 1).rotated(rotation)
	force = force.linear_interpolate(move_direction, rand_range(-max_starting_speed, max_starting_speed))
	apply_central_impulse(force)
	angular_velocity = rand_range(-2.5, 2.5)
	transform.scaled(Vector2(current_size, current_size))

func _integrate_forces(state):
	$LevelWarp._integrate_forces(state)
	angular_velocity = clamp(angular_velocity, -5, 5)
	
	$Label.text = str(current_size)

func _exit_tree():
	if current_size > 1:
		var parent = get_parent()
		print('destroyed at: ', position)
		for i in range(2):
			var asteroid = asteroid_resource.instance() as RigidBody2D
			var new_pos = position + $TakesDamage.last_damage_direction * 32
			asteroid.position = new_pos
			asteroid.current_size = current_size - 1
			parent.add_child(asteroid)"

[sub_resource type="CircleShape2D" id=2]
radius = 12.6016

[node name="Asteroid" type="RigidBody2D"]
gravity_scale = 0.0
continuous_cd = 2
contact_monitor = true
sleeping = true
linear_damp = 0.0
angular_damp = 0.0
script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="."]
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource( 2 )

[node name="TakesDamage" parent="." instance=ExtResource( 2 )]

[node name="LevelWarp" parent="." instance=ExtResource( 3 )]

[node name="Label" type="Label" parent="."]
margin_right = 40.0
margin_bottom = 14.0
