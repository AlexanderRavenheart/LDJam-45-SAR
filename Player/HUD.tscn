[gd_scene load_steps=13 format=2]

[ext_resource path="res://Assets/hud/icoHealth.png" type="Texture" id=1]
[ext_resource path="res://Assets/hud/health1.png" type="Texture" id=2]
[ext_resource path="res://Assets/hud/health2.png" type="Texture" id=3]
[ext_resource path="res://silkscreen.tres" type="DynamicFont" id=4]
[ext_resource path="res://Assets/hud/icoShield.png" type="Texture" id=5]
[ext_resource path="res://Assets/hud/shield1.png" type="Texture" id=6]
[ext_resource path="res://Assets/hud/shield2.png" type="Texture" id=7]
[ext_resource path="res://Assets/hud/icoTime.png" type="Texture" id=8]
[ext_resource path="res://Assets/hud/icoProgress.png" type="Texture" id=9]
[ext_resource path="res://Assets/hud/progress1.png" type="Texture" id=10]
[ext_resource path="res://Assets/hud/progress2.png" type="Texture" id=11]

[sub_resource type="GDScript" id=1]
script/source = "extends Control

enum TimeFormat {
    FORMAT_HOURS   = 1 << 0,
    FORMAT_MINUTES = 1 << 1,
    FORMAT_SECONDS = 1 << 2,
    FORMAT_DEFAULT = 1 << 0 | 1 << 1 | 1 << 2
}

var health_text
var health_progress
var shield_text
var shield_progress
var time_text
var level_progress

func format_time(time, format = TimeFormat.FORMAT_DEFAULT, digit_format = \"%02d\"):
    var digits = []

    if format & TimeFormat.FORMAT_HOURS:
        var hours = digit_format % [time / 3600]
        digits.append(hours)

    if format & TimeFormat.FORMAT_MINUTES:
        var minutes = digit_format % [time / 60]
        digits.append(minutes)

    if format & TimeFormat.FORMAT_SECONDS:
        var seconds = digit_format % [int(ceil(time)) % 60]
        digits.append(seconds)

    var formatted = String()
    var colon = \" : \"

    for digit in digits:
        formatted += digit + colon

    if not formatted.empty():
        formatted = formatted.rstrip(colon)

    return formatted

# Called when the node enters the scene tree for the first time.
func _ready():
	health_progress = $GridContainer/VBoxContainer/HealthContainer/HealthProgress
	health_text = $GridContainer/VBoxContainer/HealthContainer/HealthProgress/HealthText
	shield_progress = $GridContainer/VBoxContainer/ShieldContainer/ShieldProgress
	shield_text = $GridContainer/VBoxContainer/ShieldContainer/ShieldProgress/ShieldText
	time_text = $GridContainer/TimeContainer/TimeLabel
	level_progress = $ProgressContainer/LevelProgress
	level_progress.set_value(0)

func _on_time_elapsed(time_ms):
	time_text.text = format_time(time_ms / 1000, TimeFormat.FORMAT_MINUTES | TimeFormat.FORMAT_SECONDS)

func _on_progress_increased(value):
	level_progress.set_value(value)

func set_max_scrap_ammount(value):
	level_progress.set_max(value)

func _on_Player_armor_changed(value: int)->void:
	health_text.text = str(value) + \"/100\"
	health_progress.value = value

func _on_Player_shield_changed(value: int)->void:
	shield_text.text = str(value) + \"/100\"
	shield_progress.value = value
"

[node name="HUD" type="MarginContainer"]
anchor_right = 1.0
anchor_bottom = 1.0
custom_constants/margin_right = 10
custom_constants/margin_top = 10
custom_constants/margin_left = 10
custom_constants/margin_bottom = 10
script = SubResource( 1 )

[node name="GridContainer" type="GridContainer" parent="."]
margin_left = 10.0
margin_top = 10.0
margin_right = 470.0
margin_bottom = 260.0
columns = 2
__meta__ = {
"_edit_lock_": true
}

[node name="VBoxContainer" type="VBoxContainer" parent="GridContainer"]
margin_right = 409.0
margin_bottom = 11.0
size_flags_horizontal = 3

[node name="HealthContainer" type="HBoxContainer" parent="GridContainer/VBoxContainer"]
margin_right = 121.0
margin_bottom = 8.0
size_flags_horizontal = 0
size_flags_vertical = 0
custom_constants/separation = 10

[node name="HealthIcon" type="TextureRect" parent="GridContainer/VBoxContainer/HealthContainer"]
margin_right = 9.0
margin_bottom = 8.0
texture = ExtResource( 1 )

[node name="HealthProgress" type="TextureProgress" parent="GridContainer/VBoxContainer/HealthContainer"]
editor/display_folded = true
margin_left = 19.0
margin_right = 121.0
margin_bottom = 8.0
value = 100.0
texture_over = ExtResource( 2 )
texture_progress = ExtResource( 3 )

[node name="HealthText" type="Label" parent="GridContainer/VBoxContainer/HealthContainer/HealthProgress"]
margin_left = 18.0
margin_top = -1.4
margin_right = 73.0
margin_bottom = 9.6
size_flags_horizontal = 0
size_flags_vertical = 0
custom_fonts/font = ExtResource( 4 )
text = "100 / 100"
align = 1
valign = 1

[node name="ShieldContainer" type="HBoxContainer" parent="GridContainer/VBoxContainer"]
visible = false
margin_top = 12.0
margin_right = 121.0
margin_bottom = 20.0
size_flags_horizontal = 0
size_flags_vertical = 0
custom_constants/separation = 10

[node name="ShieldIcon" type="TextureRect" parent="GridContainer/VBoxContainer/ShieldContainer"]
margin_right = 9.0
margin_bottom = 8.0
texture = ExtResource( 5 )

[node name="ShieldProgress" type="TextureProgress" parent="GridContainer/VBoxContainer/ShieldContainer"]
editor/display_folded = true
margin_left = 19.0
margin_right = 121.0
margin_bottom = 8.0
value = 100.0
texture_over = ExtResource( 6 )
texture_progress = ExtResource( 7 )

[node name="ShieldText" type="Label" parent="GridContainer/VBoxContainer/ShieldContainer/ShieldProgress"]
margin_left = 18.0
margin_top = -1.4
margin_right = 73.0
margin_bottom = 9.6
size_flags_horizontal = 0
size_flags_vertical = 0
custom_fonts/font = ExtResource( 4 )
text = "100 / 100"
align = 1
valign = 1

[node name="TimeContainer" type="HBoxContainer" parent="GridContainer"]
margin_left = 413.0
margin_right = 460.0
margin_bottom = 11.0
size_flags_horizontal = 0
size_flags_vertical = 0
custom_constants/separation = 6

[node name="TimeLabel" type="Label" parent="GridContainer/TimeContainer"]
margin_right = 32.0
margin_bottom = 11.0
size_flags_horizontal = 0
size_flags_vertical = 0
custom_fonts/font = ExtResource( 4 )
custom_colors/font_color = Color( 0.588235, 0, 1, 1 )
text = "MM:SS"

[node name="TextureRect" type="TextureRect" parent="GridContainer/TimeContainer"]
margin_left = 38.0
margin_right = 47.0
margin_bottom = 8.0
size_flags_horizontal = 0
size_flags_vertical = 0
texture = ExtResource( 8 )

[node name="ProgressContainer" type="HBoxContainer" parent="."]
margin_left = 167.0
margin_top = 252.0
margin_right = 313.0
margin_bottom = 260.0
size_flags_horizontal = 4
size_flags_vertical = 8
alignment = 1

[node name="ProgressIcon" type="TextureRect" parent="ProgressContainer"]
margin_right = 9.0
margin_bottom = 8.0
texture = ExtResource( 9 )

[node name="LevelProgress" type="TextureProgress" parent="ProgressContainer"]
margin_left = 13.0
margin_right = 146.0
margin_bottom = 8.0
max_value = 20.0
value = 20.0
texture_over = ExtResource( 10 )
texture_progress = ExtResource( 11 )
